{"schemaVersion":{"major":0,"minor":3,"patch":0},"variants":[{"paths":["\/documentation\/iscp\/startupstream"],"traits":[{"interfaceLanguage":"swift"}]},{"paths":["\/documentation\/iscp\/startupstream"],"traits":[{"interfaceLanguage":"occ"}]}],"metadata":{"roleHeading":"Article","title":"Start Upstream","modules":[{"name":"iSCP"}],"role":"article"},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/jp.co.aptpod.iSCP\/documentation\/iSCP\/StartUpstream"},"sections":[],"abstract":[{"text":"アップストリームの送信サンプルです。このサンプルでは、基準時刻のメタデータと、文字列型のデータポイントをiSCPサーバーへ送信しています。","type":"text"}],"kind":"article","primaryContentSections":[{"kind":"content","content":[{"level":2,"type":"heading","text":"Overview","anchor":"overview"},{"syntax":"swift","code":["\/\/\/ 送信するデータを永続化するかどうか","var upstreamPersist: Bool = false","\/\/\/ オープンしたストリーム一覧","var upstreams: [Upstream] = []","","extension ExampleViewController {","    ","    func startUpstream() {","        \/\/ セッションIDを払い出します。","        let sessionID = UUID().uuidString.lowercased()","        ","        \/\/ Upstreamをオープンします。","        connection?.openUpstream(sessionID: sessionID,","                                 persist: upstreamPersist,","                                 completion: { [weak self] upstream, error in","            guard let upstream = upstream else {","                \/\/ オープン失敗。","                return","            }","            \/\/ オープン成功。","            upstreams.append(upstream)","            ","            \/\/ 送信するデータポイントを保存したい場合や、アップストリームのエラーをハンドリングしたい場合はデリゲートを設定します。","            upstream.delegate = self \/\/ UpstreamDelegate","            ","            let baseTime = Date().timeIntervalSince1970 \/\/ 基準時刻です。","            ","            \/\/ 基準時刻をiSCPサーバーへ送信します。","            connection?.sendBaseTime(","                baseTime: BaseTime(","                    sessionID: sessionID,","                    name: \"manual\",","                    priority: 60,","                    elapsedTime: 0,","                    baseTime: baseTime),","                persist: upstreamPersist) { error in","                    if error != nil {","                        \/\/ 基準時刻の送信に失敗。","                        return","                    }","                    \/\/ 基準時刻の送信に成功。","                ","                    \/\/ 文字列型のデータポイントをiSCPサーバーへ送信します。","                    upstream.writeDataPoint(","                        dataID: DataID(","                            name: \"greeting\",","                            type: \"string\"),","                        dataPoint: DataPoint(","                            elapsedTime: Date().timeIntervalSince1970-baseTime, \/\/ 基準時刻からの経過時間をデータポイントの経過時間として打刻します。","                            payload: \"hello\".data(using: .utf8) ?? Data())","                    )","                }","        })","    }","    ","}","","extension ExampleViewController : UpstreamDelegate {","    ","    func didGenerateChunk(upstream: Upstream, message: UpstreamChunk) {","        \/\/ バッファへ書き込んだデータポイントが実際に送信される直前にコールされます。","    }","    ","    func didReceiveAck(upstream: Upstream, message: UpstreamChunkAck) {","        \/\/ データポイントの送信後に返却されるACKを受信できた場合にコールされます。","    }","    ","    func didFailWithError(upstream: Upstream, error: Error) {","        \/\/ 内部でエラーが発生した場合にコールされます。","    }","    ","    func didCloseWithError(upstream: Upstream, error: Error) {","        \/\/ 何らかの理由でストリームがクローズした場合にコールされます。","        \/\/ 再度アップストリームをオープンしたい場合は、 `Connection.reopenUpstream()` を使用することにより、ストリームの設定を引き継いで別のストリームを開くことが可能です。","    }","    ","    func didResume(upstream: Upstream) {","        \/\/ 自動再接続機能が働き、再接続が行われた場合にコールされます。","    }","    ","}"],"type":"codeListing"}]}],"hierarchy":{"paths":[["doc:\/\/jp.co.aptpod.iSCP\/documentation\/iSCP"]]},"references":{"doc://jp.co.aptpod.iSCP/documentation/iSCP":{"abstract":[{"type":"text","text":"iSCP Client for Swift は、iSCP version 2 を用いたリアルタイムAPIにアクセスするためのクライアントライブラリです。"}],"title":"iSCP","role":"collection","identifier":"doc:\/\/jp.co.aptpod.iSCP\/documentation\/iSCP","url":"\/documentation\/iscp","type":"topic","kind":"symbol"}},"variantOverrides":[{"patch":[{"op":"replace","path":"\/identifier\/interfaceLanguage","value":"occ"},{"op":"add","path":"\/topicSections","value":null},{"op":"add","path":"\/seeAlsoSections","value":null}],"traits":[{"interfaceLanguage":"occ"}]}]}